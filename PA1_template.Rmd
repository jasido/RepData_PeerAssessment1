---
title: "Reproducible Research: Peer Assessment 1"
output:
  html_document:
    keep_md: true
---

```{r include = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, prompt = TRUE, 
                      comment = "", fig.path = "fig/")
```

The goal is to create a reproducible analysis of a certain data set. 
Specifically, we will explore and ask questions to gain an insight about personal activity data generated by an anonymous individual from the months of October and November, 2012. To obtain the data, simply clone the repository. 

## **Loading and preprocessing the data**

```{r}
# Load necessary packages
library(tidyverse)
library(lubridate)
library(ggthemes)

# Reading a zip file is pretty straightforward
activity_data <- read_csv("activity.zip")

# Gettin a sense of the data
glimpse(activity_data)
```

Apparently the data has **`r nrow(activity_data)`** rows and **`r ncol(activity_data)`** columns. We can also see the corresponding data types for each column. The following table describes each variable:

|**Column name** | **Description**|
|:---:|:---:|
|**steps**| number of steps taken per 5-minute interval 
|**date**| period on which the measurement was taken in YYYY-MM-DD format|
|**interval**| identifier for the 5-minute interval in which measurement was taken|

Looking at the first ten rows, 

```{r}
head(activity_data, n = 10)
```

Notice we have `NA` values. These are the missing values
of the data. We'll delve into how to fill these values later. For now, let's answer
some questions.

## **What is mean total number of steps taken per day?**

Excluding the rows that have missing values. First, let's create a table which
summarizes the total steps taken per day.

```{r}
df <- activity_data %>%
        # remove NA's first then
        drop_na(steps) %>%
        # aggregate by date
        group_by(date) %>%
        # calculate the sum of steps per group
        summarise(steps_per_day = sum(steps))
df 
```

We can also visually inspect the table to get an idea of how the number of steps taken each day is distributed. 

```{r}
df %>% ggplot(aes(steps_per_day)) +
        geom_histogram(bins = 10, color = "black", fill = "royalblue") +
        labs(x = "Number of Steps", 
             y = "Number of Days",
             title = "Steps generated per Day (excluding missing data)") + 
        theme_economist() + 
        theme(axis.title = element_text(size = 13))
```



From the histogram, We can infer that the mean is roughly around 10,000 steps.
Analytically, the total mean number of steps taken each day is

```{r}
mean(df$steps_per_day) 
```

and the median at

```{r}
median(df$steps_per_day)
```

## **What is the average daily activity pattern?**

Let's create another table summarizing daily activity. Specifically, let's look at the average steps taken on each interval across all days. 

```{r}
df <- activity_data %>%
        # remove NA's first then
        drop_na() %>%
        # aggregate by interval
        group_by(interval) %>%
        # compute for the mean step per interval
        summarize(average_steps = mean(steps))
df
```

We can generate a time-series plot to see how the average number of steps
on each interval per day varies. 

```{r}
df %>% ggplot(aes(interval, average_steps)) +
        geom_line(size = 1.2) +
        labs(x = "Interval", 
             y = "Number of Steps", 
             title = "Average number of Steps per Interval" ) +
        theme_economist() + 
        theme(axis.title = element_text(size = 13))
```


Looking at the graph, we can say that there is a 5-minute interval or time of the day at which the anonymous individual took more than 200 steps on the average. 

The exact interval along with the maximum number of steps taken on average is at

```{r}
df[which.max(df$average_steps),]
```

That's **206 steps** made on the **835th interval** on average.

 

## **Imputing missing values**

Now, we delve at `NA`'s. As said before, these are missing values. Since we don't
know what to think about these values, we excluded it in earlier computations. This time, let's try to fill them in and see how they affect previously computed summaries.
First, let's check the total number of missing values

```{r}
sum(is.na(activity_data))
```

So there's a total of **`r sum(is.na(activity_data))`** `NA`'s. These values exist only on column/s

```{r}
map(activity_data, ~sum(is.na(.)))
```

Indeed, only the **`steps`** column contains **`r map(activity_data, ~sum(is.na(.)))$steps`** missing data. There's a lot of methods for imputing missing values. But for the purpose of this assignment, we'll make it simple and impute these by using the mean of the interval they belong to.

Recall that we can get these values from the table above.

```{r}
df
```

We'll just have to round the average steps on each interval to whole numbers.

```{r}
df <- df %>%
        mutate(average_steps = round(average_steps))
df
```

Now, to fill the `NA`'s we'll have to merge this **`df`** dataframe with our original table, **`activity_data`**.

```{r}
df_nona <- activity_data %>%
        # merge two table by the interval column 
        left_join(df, by = c("interval" = "interval"))
df_nona
```

We can see now the column **`average_steps`** from **`df`** table. We'll alter the **`steps`** column using this column.

```{r}
df_nona <- df_nona %>%
        # if steps is NA, fill value from average_steps, otherwise do nothing
        mutate(steps = ifelse(is.na(steps), average_steps, steps)) %>%
        # selecting all columns except average_steps
        select(-4)
df_nona
```

Let's check the number of `NA`'s now.

```{r}
sum(is.na(df_nona))
```

Awesome! Let's recreate the histogram from before. 

```{r}
# create a table which is 
df_nona_hist <- df_nona %>% 
        # aggregated by date
        group_by(date) %>%
        # and has the total steps per date
        summarize(steps_per_day = sum(steps)) 

# Generate histogram        
df_nona_hist %>% ggplot(aes(steps_per_day)) +
                geom_histogram(bins = 10, color = "black", fill = "royalblue") +
                labs(x = "Number of Steps", 
                     y = "Number of Days",
                     title = "Steps generated per Day (filled missing data)") + 
                theme_economist() + 
                theme(axis.title = element_text(size = 13))
```


Unsurprisingly, the shape of the distribution is still the same (since we just add the means of each interval) but we have more observations now towards the middle.  

Analytically, the mean of the new dataframe is

```{r}
mean(df_nona_hist$steps_per_day)
```

with median at

```{r}
median(df_nona_hist$steps_per_day)
```


## **Are there differences in activity patterns between weekdays and weekends?**

To answer this question, we'll first create a new variable/column which indicates if a given observation is a `"weekday"` or a `"weekend"`. We'll use **`wday()`** function from the **`lubridate`** package which gives the numeric value for
a given day of the week and **`ifelse`** function to check if a given observation is within a certain range. If it is within `1:5` with `1` representing `Monday`, then the function outputs `"weekday"`, `"weekend"` otherwise.

```{r}
df_nona_wday <- df_nona %>%
        mutate(day_of_the_week =
          ifelse(wday(date, week_start = 1) %in% 1:5,"weekday","weekend")) %>%
        group_by(interval, day_of_the_week) %>%
        summarize(average_steps = mean(steps))
df_nona_wday
```

Visually, we can show the difference between the number of steps taken on weekdays or weekends. 

```{r}
df_nona_wday %>%
        ggplot(aes(interval,average_steps, color = day_of_the_week)) + 
          geom_line(size = 1.2) + 
          labs(x = "Interval",
               y = "Number of Steps",
               title = "Steps generated on Weekdays vs Weekends") +
          facet_grid(day_of_the_week ~.) +
          theme_economist() +
          theme(legend.position = "none", 
                axis.title = element_text(size = 12),
                strip.text.y = element_text(size = 12, face = "bold.italic"))
```


Interestingly, weekends generally have more spikes than weekdays. That is, there are more steps made on certain intervals/time of the day on weekends than on weekdays by the anonymous individual.
